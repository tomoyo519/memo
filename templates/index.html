<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
      crossorigin="anonymous"
    />

    <!-- JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>

    <!-- 구글폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@300&family=Rajdhani&display=swap"
      rel="stylesheet"
    />

    <title>SW사관학교 정글 | 나홀로 메모장 ver 2.0</title>

    <!-- style -->
    <style type="text/css">
      * {
        font-family: "IBM Plex Sans KR", sans-serif;
        font-family: "Rajdhani", sans-serif;
      }

      .wrap {
        width: 900px;
        margin: auto;
      }

      .form-post {
        width: 500px;
      }

      #card-list {
        width:900px;
      }
      .card{
        width:290px;
        margin:5px;
      }

      .form-control {
        width: 450px;
      }
    </style>
    <script>
      $(document).ready(function () {
      showMemos();
      });


      function postMemo() {
        
        let memoTitle = $("#input-title").val();
        let memoCtx = $("#input-text").val();
    
        let id = Math.floor(Math.random() * 99999)
        $.ajax({
          type: "POST",
          url: "/memo",
          data: { title_give: memoTitle, ctx_give: memoCtx, id_give: id },
          success: function (response) {
            // 성공하면
            if (response["result"] == "success") {
              alert("저장 완료!");
              $("#input-title").val('');
              $("#input-text").val('');
              showMemos();
            } else {
              alert("실패!");
            }
          },
        });
      }

      function showMemos() {
        $("#card-list").html("");
        $.ajax({
          type: "GET",
          url: "/memo",
          data: {},
          success: function (response) {
            let memos = response["memos"];

            for (let i = 0; i < memos.length; i++) {
              makeCard(
                 memos[i]["id"],
                memos[i]["title"],
                memos[i]["ctx"]
              );
            }
          },
        });
      }

      function makeCard(id, title, desc) {
        let tem_HTML = `<div class="card" id="${id}">
         <div class="card-body">
            <a href="#" class="card-title">${title}</a>
            <p class="card-text">
              ${desc}
            </p>
            <button type="button" class="btn btn-info" onclick="editMode(${id})">수정</button>
            <button type="button" class="btn btn-danger" onclick="deleteMode(${id})">삭제</button>
        </div>
        `;
        $("#card-list").append(tem_HTML);
      }

      function editMode(id){
         $('#'+id).children('div').hide();
         $.ajax({
          type: "POST",
          url: "/findmemo",
          data: { id_give: id },
          success: function (response) {
            if (response["result"] == "success") {
              let memo = response["memo"]


              let tem_HTML = `
              <div class="card-body flex-fill">
                  <div class="form-group">
                  <label for="post-url"></label>
                  <input id="input-title${id}" class="mod-title" placeholder="수정할 제목을 입력하세요" value="${memo.title}" />
                </div>
                  <div class="form-group">
                  <label for="post-url"></label>
                  <input id="input-text${id}" class="mod-text" placeholder="수정할 내용을 입력하세요" value="${memo.ctx}"" />
                </div>
                  <button type="button" class="btn btn-info" onclick="saveMode(${id})">저장</button>
              `;
              $("#"+id).append(tem_HTML);

            } else {
              alert("실패!");
            }
          },
        });
      }

      function deleteMode(id){
         $.ajax({
          type: "POST",
          url: "/deletememo",
          data: { id_give: id },
          success: function (response) {
            if (response["result"] == "success") {
              alert("삭제 완료!");
              showMemos();
            } else {
              alert("실패!");
            }
          },
        });
      }

      function saveMode(id){
        let memoTitle = $("#"+"input-title"+id).val();
        let memoCtx = $("#input-text"+id).val();
        $.ajax({
          type: "POST",
          url: "/editmemo",
          data: { title_give: memoTitle, ctx_give: memoCtx, id_give: id },
          success: function (response) {
            if (response["result"] == "success") {
              alert("수정 완료!");
              showMemos();
            } else {
              alert("실패!");
            }
          },
        });
      }
    </script>
  </head>

  <body>
    <div class="wrap">
      <div class="jumbotron">
        <div class="d-flex">
        <h1 class="display-4 font-weight-bolder">나홀로 메모장</h1>
        <h1>  <span class="badge badge-secondary ml-3">ver2.0</span></h1>
        
        </div>
       
     


      <div  class="form-post" >
        <div>
          <div class="form-group">
            <label for="post-url"></label>
            <input id="input-title" class="form-control" placeholder="제목을 입력하세요" />
          </div>
          <textarea
              id="input-text"
              class="form-control"
              rows="2"
              placeholder="내용을 입력하세요"
            ></textarea>
          </div>
         <button
            onclick="postMemo()"
            id="btn-post-box"
            type="submit"
            class="btn btn-primary mt-3"
          >
          저장하기
          </button>
        </div>
        
      </div>
      <div class="container">
      <div id="card-list" class="row" >
       <div class="card ">
         <div class="card-body">
            <a href="#" class="card-title">제목</a>
            <p class="card-text">
              내용
            </p>
            <button type="button" class="btn btn-info">수정</button>
            <button type="button" class="btn btn-danger">삭제</button>
        </div>
      </div>
      </div>
    </div>
 </div>
    </div>
  </body>
</html>
